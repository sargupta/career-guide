_format_version: "3.0"
_transform: true

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# SARGVISION AI â€” Hybrid Defense Kong Configuration
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

services:
  - name: sargvision-backend
    url: http://backend:8000
    routes:
      - name: api-root
        paths:
          - /api
        strip_path: true

  - name: gemini-ai-service
    host: localhost # Placeholder, ai-proxy plugin will handle routing
    port: 80
    plugins:
      # ğŸ›¡ï¸ AI Proxy: Centralise and secure Gemini calls
      - name: ai-proxy
        config:
          route_type: "llm/v1/chat"
          auth:
            header_name: "Authorization"
            header_value: "Bearer ${GOOGLE_API_KEY}"
          model:
            provider: "gemini"
            name: "gemini-2.0-flash"

    routes:
      - name: ai-chat-route
        paths:
          - /v1/chat/completions

plugins:
  # ğŸ”‘ Global Key Auth for the Gateway
  - name: key-auth
    config:
      key_names:
        - apikey

  # ğŸ“ˆ Prometheus for Observability
  - name: prometheus
    config:
      status_code_metrics: true
      latency_metrics: true

consumers:
  - username: default-student
    keyauth_credentials:
      - key: "sargvision-secure-key"
